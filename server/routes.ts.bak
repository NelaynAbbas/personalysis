// This is a backup for routes.ts in case it was corrupted
import express, { Express, Request, Response, NextFunction } from 'express';
import { Server, WebSocket } from 'ws';
import { PgStorage } from './storage';
import { Demographics } from '@shared/schema';

export async function registerRoutes(app: Express, storage: PgStorage): Promise<Server> {
  // Create WebSocket server for real-time collaboration
  const wss = new Server({ noServer: true });
  
  app.get('/api/test/enhance-demo-account', async (req: Request, res: Response) => {
    console.log('Enhance demo account endpoint called');
    try {
      // Import the dedicated function for generating demo data
      const { generateDemoData } = await import('./generateDemoData');
      
      // Generate demo data
      console.log('Starting demo data generation process...');
      const result = await generateDemoData();
      
      // Return result
      if (result.success) {
        return res.status(200).json(result);
      } else {
        return res.status(500).json(result);
      }
    } catch (error) {
      console.error('Error in enhance-demo-account endpoint:', error);
      return res.status(500).json({
        success: false,
        message: 'Error enhancing demo account',
        error: error instanceof Error ? error.message : String(error)
      });
    }
  });

  return wss;
}